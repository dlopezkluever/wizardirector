Stage Progression and Gating Implementation Plan
This plan outlines the steps to implement Feature 1.6 of the task list, focusing on pipeline dependencies, checkpoints, and project management.

1. Backend Infrastructure
1.1 Project Deletion
Add DELETE /api/projects/:id to backend/src/routes/projects.ts.
Ensure it handles cascading deletes (though foreign keys in DB already handle most of this).
1.2 Project List Enhancement
Update GET /api/projects in backend/src/routes/projects.ts to:
Fetch the latest stage_states for each project's active branch.
Calculate currentStage as the highest stage reached + 1.
Populate the stages array with correct StageStatus for the frontend.
1.3 Sequential Locking Validation
Update POST /api/projects/:projectId/stages/:stageNumber/lock in backend/src/routes/stageStates.ts to:
Verify that stage N-1 is locked before allowing stage N to be locked.
Return a 400 error if prerequisites are not met.
2. Frontend Services
Add deleteProject(projectId: string): Promise<void> to src/lib/services/projectService.ts.
3. Dashboard and Project Management
3.1 Project Card Updates
Add a delete button (using Trash2 icon) to src/components/dashboard/ProjectCard.tsx.
Implement a confirmation dialog using a custom UI component or browser confirm.
Improve the visual status indicator to clearly show draft, locked, outdated, etc.
3.2 Dashboard Refresh
Ensure src/pages/Dashboard.tsx refreshes the project list after a successful deletion.
4. Pipeline Progression and Gating
4.1 Interactive PhaseTimeline
Modify src/components/pipeline/PhaseTimeline.tsx:
Add onStageClick prop.
Make stage nodes clickable if their status is not pending.
Apply cursor-pointer and hover effects to clickable nodes.
Disable navigation to future stages that are not yet reached.
4.2 ProjectView Navigation and Guards
Update src/pages/ProjectView.tsx:
Implement handleNavigate to change currentStage when a timeline node is clicked.
Add a useEffect guard that validates currentStage. If a user tries to access a pending stage (e.g., via URL or state manipulation), redirect them to the highest allowed stage.
Update handleStageComplete to properly synchronize with the backend lockStage call.


5. Implementation Roadmap
Backend: Project deletion and enhanced project list.
Backend: Sequential locking validation.
Frontend: Project deletion service and UI.
Frontend: Interactive timeline and ProjectView navigation guards.



Do later:
Frontend: Stage 5 Assets persistence and locking.

4.3 Stage 5 Assets Persistence
Update src/components/pipeline/Stage5Assets.tsx:
Replace mock data with real state management using the useStageState hook.
Implement the "Lock Assets" button to call lockStage(projectId, 5) and then navigate to Stage 6.