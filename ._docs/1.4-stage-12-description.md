
### **Stage 12: Video Generation, Review & Iteration Loop; description**

**Tool:** Google Veo3 API (Video \+ Audio generation). **Process:** Submits the confirmed Start Frame, End Frame, and formatted prompt to Veo3.

**Review and Error Handling:**

* **Video Playback:** User views the full scene, cut together from the individual 8-second clips.  
* **Issue Resolution:** The user can select one of three iterative paths:  
  1. **SUCCESS:** "Complete Scene." Returns to the Script Hub.  
  2. **VISUAL ISSUE (Minor):** "Return to Stage 8 (Frames)." Requires regeneration of the anchor frames, meaning the video will be re-queued and credits charged again.  
  3. **NARRATIVE/AUDIO ISSUE (Major):** "Return to Stage 7 (Shot List)." Requires deep structural changes, potentially leading to a cascade of changes in Stages 8, 9, and 10\.


Stage 12: Video Generation, Review & Iteration Loop; more info**

### **Purpose**

Stage 12 generates the final video and routes the user back to the appropriate upstream stage if issues are detected.

### **UI/UX Definition**

* Timeline-based video player with shot markers  
* Issue classification controls:  
  * Visual continuity  
  * Timing  
  * Dialogue/audio  
  * Narrative structure
* **Render Re-Entry Logic** (Stretch Goal):
  * When a background render (defined in 12.2) is complete, clicking the notification or the "Complete" status in the Script Hub (Stage 6) must drop the user directly into the Stage 12 Review Player for that specific scene.

### **Agentic Tooling**

* **Failure Attribution Agent:** Maps issues to the most likely upstream stage


Questions:

 User answered Claude's questions:
  ⎿  · Should we integrate with the real Google Vertex AI Veo3 API in this phase, or build    
      the architecture with a mock/simulated video generation service that can be swapped     
     out later? (Real integration requires Vertex AI credentials and billing setup) → Both    
      (feature flag)
     · For the background job processor: The current codebase has NO job queue library (no    
      Bull/BullMQ). The image generation service uses a simple 'fire and forget' pattern      
     with database polling. What approach do you want for video generation jobs? → 
     Database polling (Recommended)
     · For the scene video assembly (stitching individual 8-second shot clips into one        
     continuous scene video): How should this work? → Client-side sequential playback         
     (Recommended)
     · The docs mention a notification system for render completion. What scope do you        
     want for notifications in this phase? → Toast + Script Hub badge


● The current Stage 12 issue resolution maps issues to stages differently than the docs. Docs  say: Visual → Stage 8 (Frames), Narrative/Audio → Stage 7 (Shot List). Current code maps:   
 Visual Continuity → Stage 10, Timing → Stage 7, Dialogue/Audio → Stage 9, Narrative → Stage  
 7. Which mapping should we use?
   → Keep expanded 4-option
 ● For the video player experience: The current skeleton uses basic HTML5 video for individual  shots. For the sequential playback of all shots as a scene, what level of player should we  
 build?
   → Enhanced custom player
 ● Should we implement the 'Render Re-Entry' feature (clicking a notification or Script Hub   
 badge drops user directly into Stage 12 review for that scene)?
   → Yes, implement now



More to consider: 

To imporve UI/UX of stage 12: 

 3. Side-by-side view
     Scene player on left, individual shot list with thumbnails on right. Click a shot to jump      to it. Timeline shows shot boundaries.

Matches the spec: 1.4 and the Stage 12 description call for a “timeline-based video player with shot markers” and “playback controls (play/pause/scrub).” Option 1 delivers that: timeline, shot markers, scrub across the full scene, current-shot indicator, and shot thumbnails. Option 2 doesn’t really give you a proper timeline with shot markers or full-scene scrub.
Supports the workflow: Issue resolution (visual / timing / dialogue / narrative) is easier when the user can see where they are in the scene and which shot is playing. A timeline with shot boundaries and a current-shot indicator does that without a more complex layout.
Scope: Still a single main player; no second panel or new layout. Auto-advance between shots and shot thumbnails on the timeline are a natural extension of “shot markers” and keep the implementation manageable.
Option 3 (side-by-side) is a good next step if you later want to emphasize “which shot has the issue?” with a clickable shot list and jump-to-shot. For 1.4, Option 1 is the right target: it fulfills the docs and keeps scope contained.

4. Future enhancement:

