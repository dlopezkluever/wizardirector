# Feature 5.3: Status Metadata Tags — Testing Checklist

**Scope:** Implemented tasks **2, 3, 4, and 5** (Tasks 1, 6, and 7 not implemented).  
**Prerequisites:** Feature 5.1 (Scene Asset Instances) and 5.2 (Stage 8 UI) in place; backend running; at least one project with scenes at Stage 7+ (shot list ready) so Stage 8 is accessible.

---

## Environment Setup

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | Start backend: `cd "C:\Users\Daniel Lopez\Desktop\Aiuteur\wizardirector\backend"` then `npm run dev` | Server runs on port 3001, no errors. |
| 2 | Start frontend: `cd "C:\Users\Daniel Lopez\Desktop\Aiuteur\wizardirector"` then `npm run dev` | Vite dev server runs on port 8080, no errors. |
| 3 | Log in and open a project that has at least one scene with status **shot_list_ready** or later | You can open the project and navigate to Stage 8 for that scene. |
| 4 | Open Stage 8 (Visual Definition) for a scene that has scene asset instances | Asset list panel and Visual State Editor are visible; you can select an asset and see/edit tags. |

---

## Task 2: Tag Category System & Semantic Styling

#
### 2.2 – ✅StatusTagsEditor category colors

| # | Test | Steps | Expected Result |
|---|------|--------|-----------------|
| 2.2.1 | Badge colors | In Stage 8, select an asset and add tags: `muddy`, `torn`, `wet`, `clean`, and one custom (e.g. `scratched`). | "muddy" shows amber (condition), "torn" red/destructive (damage), "wet" blue/info (temporal), "clean" green/success (appearance), "scratched" secondary (custom). |
| 2.2.2 | Remove tag | Click the X on one of the tag badges. | That tag is removed from the list and save/update works if applicable. |

### 2.3 – Autocomplete in StatusTagsEditor

| # | Test | Steps | Expected Result |
|---|------|--------|-----------------|
| 2.3.1 | Dropdown on focus with text | Focus the tag input, type `bl`. | A dropdown appears with suggestions (e.g. "bloody"); suggestions use category styling or at least show the tag names. |
| 2.3.2 | Click suggestion | Click "bloody" in the dropdown. | "bloody" is added as a tag and the dropdown closes; input clears. |
| 2.3.3 | Enter adds tag | Type `wet` and press Enter. | "wet" is added as a tag. |
| 2.3.4 | Escape closes dropdown | Type `tor`, then press Escape. | Dropdown closes; tag is not added from suggestion list. |
| 2.3.5 | Project tags prioritized | (If `projectTags` is passed from parent) Add a tag like `muddy` on one asset, then on another asset start typing; ensure project-used tags are passed. | Tags already used in the project appear first in the suggestion list when they match the query. |

---

## Task 3: Tag Display in Asset List Panel

### 3.1 – Tag display on asset list items

| # | Test | Steps | Expected Result |
|---|------|--------|-----------------|
| 3.1.1 | Tags on cards | In Stage 8, ensure at least one scene asset has 1–3 tags (e.g. `muddy`, `torn`). | Each such asset card shows up to 3 tag badges with correct category colors (amber, red, etc.). |
| 3.1.2 | Overflow +N | Give one asset more than 3 tags (e.g. 4 or 5). | First 3 tags show as badges; a "+N" badge appears (e.g. "+2" for 5 tags). |
| 3.1.3 | Carry-forward line | For an asset that has at least one tag and `carry_forward` true, check the card. | A line with Link2 icon and "Will carry forward" appears below the tags. |
| 3.1.4 | No carry-forward line | For an asset with tags but `carry_forward` false, or an asset with no tags. | No "Will carry forward" line is shown. |

### 3.2 – Header tag summary

| # | Test | Steps | Expected Result |
|---|------|--------|-----------------|
| 3.2.1 | Header text | Look at the asset list panel header (subtext). | Format: `X asset(s) • Y with visuals • Z with tags (W total)` with correct plural "asset"/"assets", and Z = count of assets with ≥1 tag, W = total tag count across all assets. |
| 3.2.2 | Zero tags | Use a scene with no tags on any asset. | Header shows "0 with tags (0 total)" or equivalent. |

---

## Task 4: Tag-Based Filtering & Search

### 4.1 – Search and filter UI

| # | Test | Steps | Expected Result |
|---|------|--------|-----------------|
| ✅ 4.1.1 | Search input | In the asset list panel, find the search field (with Search icon). Type part of an asset name. | List filters to assets whose name contains the query (case-insensitive); header/counts update to reflect filtered list. |
| **Search Is kinda Buggy*, *Returns weird results* 4.1.2 | Clear search | With search non-empty, click the X in the search field (or clear manually). | Search clears and full list returns. |
| 4.1.3 | Filters dropdown | Open the "Filters" dropdown. | Options visible: "Has any tags", "Carry forward enabled", and a "Filter by Tags" section with one checkbox per tag (only if there are tags in the scene). |
| 4.1.4 | Has any tags | Check "Has any tags" and close the dropdown. | Only assets with at least one tag are shown; header counts reflect filtered set. |
| 4.1.5 | Carry forward enabled | Check "Carry forward enabled". | Only assets with `carry_forward` true are shown (combined with other active filters). |
| 4.1.6 | Filter by tag | Check one or more specific tags (e.g. "muddy"). | Only assets that have **all** selected tags are shown (AND logic). |
| 4.1.7 | Combined filters | Set search + "Has any tags" + one tag. | List shows only assets that match the name, have at least one tag, and include the selected tag. |
| 4.1.8 | Filter badge count | With 1 or more filters active, look at the Filters button. | A badge shows the number of active filters (e.g. 2). |
| 4.1.9 | Active tag badges | With at least one tag filter applied, look below the dropdown. | Each selected tag appears as a removable badge (with X); clicking X removes that tag from the filter. |
| 4.1.10 | Clear all | With any combination of search + filters active, click "Clear all". | Search and all filters reset; full list and default header counts return. |

### 4.2 – Filtered list and parent callback

| # | Test | Steps | Expected Result |
|---|------|--------|-----------------|
| 4.2.1 | Header uses filtered count | Apply a filter that reduces the list. | Header line (asset count, "with visuals", "with tags") reflects **filtered** assets only. |
| 4.2.2 | Grouping uses filtered list | Apply filters so only e.g. "character" assets remain. | Grouped sections (Character, Location, Prop) only show filtered assets; empty groups can show 0 or be hidden per current UI. |
| 4.2.3 | Parent receives filters | (If possible, add a temporary log or inspect Stage8VisualDefinition state.) When you change search or any filter. | Parent receives updated filters via `onFilterChange` (e.g. `setAssetFilters`), so `assetFilters` in the parent reflects current values. |

---

## Task 5: Tag Carry-Forward Prompt (New Scene Initialization)

**Setup for Task 5:** You need two scenes in order: Scene A (prior) and Scene B (current). Scene A should have at least one scene asset instance with **tags** and **carry_forward = true**. Scene B should have inherited instances from Scene A (or equivalent so the prompt logic runs). Clear "already prompted" for Scene B so the prompt can show: in DevTools → Application → Local Storage, remove key `tag-prompt-<scene-B-id>` (or use a fresh scene ID).

### 5.1 – TagCarryForwardPrompt component (via Stage 8 integration)

| # | Test | Steps | Expected Result |
|---|------|--------|-----------------|
| 5.1.1 | Prompt appears | Open Stage 8 for a scene that has inherited instances with tags and has not been prompted yet (see setup). | A dialog opens: title like "Carry Forward Status Tags from Scene N?", description, and a list of prior-scene assets with their tags. |
| 5.1.2 | Per-asset "Carry all" | In the prompt, for one asset, uncheck "Carry all" then recheck it. | All tags for that asset become selected (checkmarks); summary updates (e.g. "X of Y tags selected"). |
| 5.1.3 | Per-tag toggle | For one asset, uncheck "Carry all", then click individual tags to select/deselect. | Tags show selected (colored, check) vs unselected (muted, X); "Carry all" checks when all tags are selected; summary count updates. |
| 5.1.4 | Tag colors in prompt | Look at tag buttons in the dialog. | Tags use the same semantic colors as elsewhere (condition=amber, damage=red, etc.) when selected. |
| 5.1.5 | Info note | Check the info box in the dialog. | Text explains that selected tags apply to the starting state of the current scene and can be edited later. |
| 5.1.6 | Carry None | Click "Carry None". | Dialog closes; all decisions are "carry no tags"; API updates are called (see 5.2.2); prompt does not show again for this scene (localStorage set). |
| 5.1.7 | Carry All | Re-open prompt (clear localStorage again). Click "Carry All". | Dialog closes; all tags for all listed assets are carried; API updates are called; success toast; prompt does not show again. |
| 5.1.8 | Confirm Selection | Re-open prompt, change some selections (e.g. deselect a few tags), click "Confirm Selection". | Dialog closes; only the selected tags are applied per asset via API; success toast; prompt does not show again. |
| 5.1.9 | On close (X or overlay) | Re-open prompt, then close it via X or clicking overlay (without Carry None / Carry All / Confirm). | Dialog closes; `tag-prompt-<sceneId>` is set in localStorage so the prompt does not show again on next load for that scene. |

### 5.2 – Integration in Stage 8 (API and state)

| # | Test | Steps | Expected Result |
|---|------|--------|-----------------|
| 5.2.1 | Correct instances in prompt | When the prompt opens, verify the list. | Only assets from the prior scene that have tags (and are relevant to the current scene’s inherited instances) are listed, with correct asset names and tag counts. |
| 5.2.2 | API updates on confirm | After "Confirm Selection" or "Carry All" or "Carry None", check network tab or backend. | PUT requests to update scene asset instances for the **current** scene with the chosen `statusTags` (and possibly `modificationReason`). |
| 5.2.3 | Scene assets refresh | After a successful confirm. | Scene assets list refreshes (e.g. via invalidation/refetch); updated tags appear on the current scene’s instances in the asset list and in the editor. |
| 5.2.4 | Error handling | (Optional) Simulate API failure, e.g. disconnect network, then confirm. | Error toast is shown; user can retry or close; localStorage may or may not be set depending on implementation (plan suggests setting only on success). |
| 5.2.5 | No prompt when already prompted | After the prompt has been shown and closed (or confirmed) for a scene, reload the page and open Stage 8 for the same scene again. | Tag carry-forward prompt does **not** appear again (localStorage key present). |
| 5.2.6 | No prompt when no tagged inheritance | Open Stage 8 for a scene that has no inherited instances with tags (e.g. first scene, or scene with no prior-scene tags). | Tag carry-forward prompt does not appear. |

---

## Quick Smoke Order

Suggested order for a single pass:

1. **Task 2:** Open Stage 8 → select asset → add tags (predefined + custom) → check badge colors → use autocomplete (type, click, Enter, Escape).
2. **Task 3:** Look at asset list → confirm tag chips (and +N) and "Will carry forward" on the right cards → check header "X with tags (Y total)".
3. **Task 4:** Use search → open Filters → try "Has any tags", "Carry forward enabled", and one tag → check "Clear all" and active tag badges.
4. **Task 5:** Prepare Scene A (tags + carry_forward) and Scene B (inherited); clear `tag-prompt-<scene-B-id>` → open Stage 8 for Scene B → run through prompt (toggle tags, Carry None, then again Carry All or Confirm) → verify API and no re-prompt.

---

## Out of Scope (Not Implemented)

- **Task 1:** Database validation trigger (tags only after Stage 7) — no tests required.
- **Task 6:** Backend tag-based query params — filtering is client-side only.
- **Task 7:** (If present in plan) — skip.

---

## Sign-off

| Area | Pass / Fail | Notes |
|------|-------------|--------|
| Task 2 – Tag categories & StatusTagsEditor | | |
| Task 3 – Tag display in list & header | | |
| Task 4 – Filtering & search | | |
| Task 5 – Carry-forward prompt & API | | |
