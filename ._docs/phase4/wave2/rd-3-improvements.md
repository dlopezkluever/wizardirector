 Plan to implement                                                                      ││                                                                                        ││ Stage 10 FramePanel Redesign — Carousel-First + Select/Regenerate                      ││                                                                                        ││ Context                                                                                ││                                                                                        ││ Live testing of the Round 2 improvements revealed fundamental UX problems with the     ││ Stage 10 frame workflow:                                                               ││ 1. The FrameGenerationCarousel renders as a separate row below the frame image —       ││ should be unified as one container (matching Stage 8's GenerationAttemptCarousel       ││ pattern)                                                                               ││ 2. Approve/Reject buttons don't make sense — should be Select (from carousel) and      ││ Regenerate                                                                             ││ 3. No delete capability for bad generations                                            ││ 4. Multiple secondary issues: redundant Gen badge, no metadata tooltip, no             ││ click-to-enlarge, broken lock gate without approve, stale progress/sidebar colors      ││                                                                                        ││ The selected/current image is the one that progresses to video generation (Stage 12).  ││ generated status = ready for lock.                                                     ││                                                                                        ││ ---                                                                                    ││ Part A: Unified FramePanel (Carousel-First)                                            ││                                                                                        ││ Goal: Merge FrameGenerationCarousel INTO FramePanel, so the carousel IS the frame      ││ display (one container per frame).                                                     ││                                                                                        ││ File: src/components/pipeline/FramePanel.tsx                                           ││                                                                                        ││ Props changes                                                                          ││                                                                                        ││ - Remove: onApprove, onReject                                                          ││ - Keep: all other props (onGenerate, onRegenerate, onRegenerateWithCorrection,         ││ onRegenerateWithEditedPrompt, currentPrompt, onInpaint, onCompare, showCompare,        ││ referenceImages, hideHeader, projectId, sceneId, isDisabled, isGenerateDisabled,       ││ disabledReason, frame, frameType, shotId)                                              ││                                                                                        ││ Internal state additions                                                               ││                                                                                        ││ - Add useQuery for generations (same as current FrameGenerationCarousel):              ││ ['frame-generations', projectId, sceneId, frameId], enabled when frame.generationCount ││  > 1 && projectId && sceneId                                                           ││ - Add selectMutation (calls frameService.selectFrameGeneration) — invalidates          ││ frame-generations + frames queries                                                     ││ - Add deleteMutation (calls new frameService.deleteFrameGeneration) — invalidates      ││ frame-generations + frames queries                                                     ││ - Add currentIndex state for carousel position                                         ││ - Add previewUrl state for click-to-enlarge dialog                                     ││                                                                                        ││ Frame Display area (replaces current lines 140-202)                                    ││                                                                                        ││ When 0 generations / no image (empty state): Keep current empty state UI (ImageIcon +  ││ message + disabled reason)                                                             ││                                                                                        ││ When generating: Keep current spinner UI                                               ││                                                                                        ││ When 1 generation (single image): Show single image with:                              ││ - Hover overlay: Inpaint + Compare buttons (existing)                                  ││ - Click → opens Dialog full-size preview                                               ││ - Tooltip on hover: prompt, cost, date (from frame.promptSnapshot, frame metadata)     ││ - Below: Regenerate button (with correction flow)                                      ││                                                                                        ││ When 2+ generations (carousel mode): Following GenerationAttemptCarousel pattern:      ││ - <Carousel> with <CarouselContent> / <CarouselItem> / <CarouselPrevious> /            ││ <CarouselNext>                                                                         ││ - opts={{ startIndex: generations.findIndex(g => g.isCurrent) }}                       ││ - Counter: {currentIndex + 1}/{total} in header area                                   ││ - Each carousel item: aspect-video image with border highlight (border-amber-400 if    ││ current, border-border/30 if not)                                                      ││ - Current/selected item overlay (hover): Inpaint + Compare buttons                     ││ - Non-current item overlay (hover): Select button (gold) + Delete button               ││ (destructive/red) — matching Stage 8 exactly                                           ││ - Badges: "Selected" amber badge on current, date badge on all                         ││ - Tooltip: prompt snapshot, cost, date (from generation data)                          ││ - Click image → Dialog modal for full-size preview                                     ││ - Below carousel: Regenerate button (with correction flow)                             ││                                                                                        ││ Remove "Gen #2" badge                                                                  ││                                                                                        ││ The generation count is now visible through the carousel counter (1/3, etc.). Remove   ││ lines 194-201 (Gen badge).                                                             ││                                                                                        ││ Action buttons (replaces current lines 230-288)                                        ││                                                                                        ││ Replace the current approve/reject/generate button logic with:                         ││                                                                                        ││ if (needsGeneration && !isGenerating):                                                 ││   → "Generate {frameType} Frame" button (gold, full-width)                             ││                                                                                        ││ if (isGenerating):                                                                     ││   → "Generating..." button (disabled)                                                  ││                                                                                        ││ if (hasImage && !isGenerating):  // covers generated, approved, rejected               ││   → "Regenerate" button (outline) — opens correction flow                              ││   // Select is handled in carousel overlay                                             ││   // No approve/reject buttons                                                         ││                                                                                        ││ Keep regeneration correction area                                                      ││                                                                                        ││ Lines 290-377 (correction textarea, manual edit, re-roll) stay as-is.                  ││                                                                                        ││ Remove FrameGenerationCarousel render                                                  ││                                                                                        ││ Remove lines 204-212 (the separate carousel render below the image). Delete            ││ FrameGenerationCarousel import.                                                        ││                                                                                        ││ ---                                                                                    ││ Part B: New Backend Endpoint — Delete Generation                                       ││                                                                                        ││ File: backend/src/routes/frames.ts                                                     ││                                                                                        ││ DELETE /:projectId/scenes/:sceneId/frames/:frameId/generations/:jobId                  ││                                                                                        ││ - Verify project ownership                                                             ││ - Fetch the job from image_generation_jobs                                             ││ - Guard: Cannot delete if job.id === frame.current_job_id (can't delete the selected   ││ generation)                                                                            ││ - Guard: Must have at least 2 completed generations to delete one                      ││ - Delete from Supabase storage (if storage_path exists)                                ││ - Delete the job record from image_generation_jobs                                     ││ - Decrement frames.generation_count                                                    ││ - Return { success: true }                                                             ││                                                                                        ││ ---                                                                                    ││ Part C: Frontend Service — Delete Generation                                           ││                                                                                        ││ File: src/lib/services/frameService.ts                                                 ││                                                                                        ││ Add method:                                                                            ││ async deleteFrameGeneration(                                                           ││   projectId: string, sceneId: string, frameId: string, jobId: string                   ││ ): Promise<{ success: boolean }>                                                       ││ Calls DELETE                                                                           ││ /api/projects/${projectId}/scenes/${sceneId}/frames/${frameId}/generations/${jobId}    ││                                                                                        ││ ---                                                                                    ││ Part D: Lock Gate — generated = Ready                                                  ││                                                                                        ││ Backend                                                                                ││                                                                                        ││ File: backend/src/services/frameGenerationService.ts (line ~838)                       ││                                                                                        ││ Change areAllFramesApproved:                                                           ││ // Before:                                                                             ││ if (!shot.startFrame || shot.startFrame.status !== 'approved') return false;           ││ // After:                                                                              ││ if (!shot.startFrame || (shot.startFrame.status !== 'approved' &&                      ││ shot.startFrame.status !== 'generated')) return false;                                 ││ Same for endFrame check. This makes both generated and approved count as "ready".      ││                                                                                        ││ Frontend progress calculation                                                          ││                                                                                        ││ File: src/lib/services/frameService.ts → calculateProgress()                           ││                                                                                        ││ Add a new readyFrames count that combines approved + generated:                        ││ readyFrames: approvedFrames + generatedFrames,                                         ││                                                                                        ││ ---                                                                                    ││ Part E: Status/Progress UI Updates                                                     ││                                                                                        ││ CostDisplay                                                                            ││                                                                                        ││ File: src/components/pipeline/CostDisplay.tsx                                          ││                                                                                        ││ - Change prop approvedFrames → readyFrames (or accept both and combine)                ││ - Progress bar: completedFrames = readyFrames (was approvedFrames)                     ││ - "All frames approved" badge → "All frames ready"                                     ││ - The amber "ready for review" badge → remove (generated IS ready now)                 ││ - Single counter badge for ready frames (green check) instead of separate              ││ approved/generated badges                                                              ││                                                                                        ││ FrameGrid (Quick Mode)                                                                 ││                                                                                        ││ File: src/components/pipeline/FrameGrid.tsx                                            ││                                                                                        ││ - Remove: onApproveAllGenerated prop and "Approve All Ready" button                    ││ - Status colors: approved AND generated both get green border/checkmark                ││ - allApproved logic: startReady && endReady where ready = approved || generated        ││                                                                                        ││ Sidebar Shot Thumbnails (Control Mode)                                                 ││                                                                                        ││ File: src/components/pipeline/Stage10FrameGeneration.tsx (lines 577-624)               ││                                                                                        ││ - Green border: status === 'approved' || status === 'generated'                        ││ - Remove amber border for generated (it's now green = ready)                           ││                                                                                        ││ ---                                                                                    ││ Part F: Remove Dead Code                                                               ││                                                                                        ││ Stage10FrameGeneration.tsx                                                             ││                                                                                        ││ - Remove approveMutation (lines 153-160)                                               ││ - Remove rejectMutation (lines 162-169)                                                ││ - Remove handleApproveAllGenerated (lines 380-395)                                     ││ - Remove onApprove / onReject props from both FramePanel instances                     ││ - Remove FrameGenerationCarousel import if still present                               ││ - In footer: change allFramesApproved label text — keep the variable name (comes from  ││ backend), just update display text                                                     ││                                                                                        ││ FramePanel.tsx                                                                         ││                                                                                        ││ - Remove onApprove and onReject from interface                                         ││ - Remove canApprove variable                                                           ││ - Remove approve/reject button branches from action buttons                            ││ - Remove isApproved button branch (the "Approved" disabled button)                     ││                                                                                        ││ FrameGenerationCarousel.tsx                                                            ││                                                                                        ││ - Delete this file entirely — its functionality is now merged into FramePanel          ││                                                                                        ││ ---                                                                                    ││ Files to Modify (Summary)                                                              ││                                                                                        ││ File: src/components/pipeline/FramePanel.tsx                                           ││ Changes: Carousel-first redesign, remove approve/reject, add                           ││   select/delete/tooltip/enlarge                                                        ││ ────────────────────────────────────────                                               ││ File: src/components/pipeline/Stage10FrameGeneration.tsx                               ││ Changes: Remove approve/reject mutations, update sidebar colors, update FramePanel     ││ props                                                                                  ││ ────────────────────────────────────────                                               ││ File: src/components/pipeline/CostDisplay.tsx                                          ││ Changes: readyFrames instead of approvedFrames, updated labels                         ││ ────────────────────────────────────────                                               ││ File: src/components/pipeline/FrameGrid.tsx                                            ││ Changes: Remove "Approve All", update status colors                                    ││ ────────────────────────────────────────                                               ││ File: src/lib/services/frameService.ts                                                 ││ Changes: Add deleteFrameGeneration(), update calculateProgress()                       ││ ────────────────────────────────────────                                               ││ File: backend/src/routes/frames.ts                                                     ││ Changes: Add DELETE generations endpoint                                               ││ ────────────────────────────────────────                                               ││ File: backend/src/services/frameGenerationService.ts                                   ││ Changes: Update areAllFramesApproved to accept generated                               ││                                                                                        ││ Delete:                                                                                ││                                                                                        ││ ┌─────────────────────────────────────────────────────┬────────────────────────┐       ││ │                        File                         │         Reason         │       ││ ├─────────────────────────────────────────────────────┼────────────────────────┤       ││ │ src/components/pipeline/FrameGenerationCarousel.tsx │ Merged into FramePanel │       ││ └─────────────────────────────────────────────────────┴────────────────────────┘       ││                                                                                        ││ ---                                                                                    ││ Implementation Order                                                                   ││                                                                                        ││ 1. Part D — Backend lock gate update (quick, unblocks testing)                         ││ 2. Part B + C — Backend delete endpoint + frontend service method                      ││ 3. Part A — FramePanel carousel-first redesign (main work)                             ││ 4. Part E — CostDisplay, FrameGrid, sidebar status updates                             ││ 5. Part F — Remove dead code (approve/reject mutations, old carousel file)             ││                                                                                        ││ ---                                                                                    ││ Verification                                                                           ││                                                                                        ││ 1. Stage 10 Control Mode: Select a shot → single frame container shows image (no       ││ separate carousel row)                                                                 ││ 2. Generate a frame, then regenerate → carousel appears with 2 items in the SAME       ││ container, arrows to navigate                                                          ││ 3. Hover non-current image → "Select" (gold) + "Delete" (red) overlay buttons          ││ 4. Hover current/selected image → "Inpaint" + "Compare" overlay buttons                ││ 5. Click "Select" on older generation → image updates, becomes current                 ││ 6. Click "Delete" on non-current generation → removed from carousel                    ││ 7. Click any image → full-size Dialog preview opens                                    ││ 8. Below image area: "Regenerate" button opens correction flow (correction text,       ││ re-roll, manual edit)                                                                  ││ 9. No Approve/Reject buttons anywhere                                                  ││ 10. Sidebar thumbnails: green for generated AND approved                               ││ 11. CostDisplay progress bar: counts generated + approved as ready                     ││ 12. FrameGrid (Quick Mode): no "Approve All" button, green status for                  ││ generated+approved                                                                     ││ 13. Lock & Proceed: enabled when all frames are generated or approved                  ││ 14. npm run lint — no new errors                                                       ││ 15. npm test (frontend) + cd backend && npm test — no regressions          