This guide provides direct instructions on how to revise **5.3-dev-plan.md** to address the architectural and UX gaps identified. The revisions are ordered from most critical (system integrity) to least critical (future-proofing).

---

### Priority 1: Branch Scope (Critical)

**Issue:** The plan doesn't specify how tags interact with the Git-style branching system.
**Revision Action:** Insert a new **Task 0** before Task 1 to establish the technical boundary.

**Add the following text before "Task 1":**

> ### Task 0: Branch-Awareness Logic (Architecture)
> 
> 
> * **Requirement:** Ensure all tag operations (read/write/propagate) are scoped to the `active_branch_id`.
> * **Implementation:** >   - Update the propagation query to filter by `branch_id`.
> * *Logic:* Tags applied in a "What-if" branch must not appear in the "Main" branch unless a merge occurs (handled in Phase 10).
> 
> 
> * **Success Criteria:** Tagging a character as "Dirty" in Scene 2 of *Branch B* does not affect Scene 2 of *Branch A*.
> 
> 

---

### Priority 2: Data Decoupling & Invalidation (High)

**Issue:** The plan is vague on whether "carry-forward" is a reference or a hard copy, and how it handles non-linear edits.
**Revision Action:** Modify **Task 4 (Tag Propagation Prompts)** to include "Hard Copy" and "Downstream" logic.

**Replace the content of Task 4 with:**

> ### Task 4: Tag Propagation & Persistence Logic
> 
> 
> * **Hard Copy Logic:** When a user accepts a "Carry-Forward" prompt, create a **new unique record** for the tag in the destination scene. Do not use pointers. (Modifying a tag in Scene 5 should not retroactively change Scene 4).
> * **Downstream Invalidation:** If a user edits tags in a "middle" scene (e.g., Scene 3 of 10), trigger a "Propagate Changes Downstream?" prompt.
> * **Bulk Action UX:** Add a "Apply to all subsequent scenes in this branch" checkbox to the prompt to prevent "modal fatigue."
> 
> 

---

### Priority 3: Stage 10 Integration (Medium)

**Issue:** The PRD states Stage 8 owns initial state and Stage 10 owns evolution. The plan doesn't link them.
**Revision Action:** Update **Task 7 (Optional: Evolution Tracking)** from a "Future Enhancement" to a "Cross-Stage Integration" requirement.

**Modify Task 7 text to:**

> ### Task 7: Stage 10 Visual Evolution Integration
> 
> 
> * **Requirement:** Map `status_tags` to the Stage 10 Video Prompt Generator.
> * **Implementation:** Create a utility function `getAssetVisualDescription(instanceId)` that concatenates the Master Asset description with active `status_tags`.
> * **Example:** Master Character "John" + Tags ["muddy", "torn"] → "John, with muddy clothes and torn fabric..." for the Stage 10 video prompt.
> 
> 

---

### Priority 4: Search & UI UX (Low/Medium)

**Issue:** Potential for "Tag Soup" (inconsistent naming).
**Revision Action:** Add a sub-bullet to **Task 3 (Tag-based Search and Filtering)**.

**Add this bullet point to Task 3:**

> * **Suggested Tags (Autocomplete):** Instead of a blank text field, the search and editor components should prioritize tags already used within the current project/branch to ensure "muddy" and "dirt-covered" aren't used interchangeably for the same visual state.
> 
> 

---

### Priority 5: Refining the "Conclusion"

**Issue:** The conclusion doesn't mention the branching constraint.
**Revision Action:** Update the first point in the **Conclusion** section.

**Change from:**

> 1. **Visual differentiation** via category-based colors
> **To:**
> 2. **Branch-isolated persistence** ensuring visual continuity remains experimental within branches.
> 
> 

---

### Final Checklist for the Revised Doc:

1. [ ] Does it mention `branch_id` in the data fetching?
2. [ ] Does Task 4 explicitly state that tags are **copied**, not **linked**?
3. [ ] Is there a "Bulk Propagate" option to save user clicks?
4. [ ] Is there a clear path for these tags to reach Stage 10 video generation?


More Context
I have analyzed the **5.3-dev-plan.md** document against your **Project Overview (PRD)**, **Development Progress**, and **Task List**.

Overall, the plan is a logically sound extension of the work already completed in Stages 5.1 and 5.2. However, because Aiuteur uses a **Git-style branching system** and a **12-stage pipeline**, there are some critical architectural "blind spots" in the plan—specifically regarding how tags flow through branches and how they interact with Stage 10 (Visual Evolution).

Here is the breakdown:

### 1. Key Flaws and Risks (Important)

* **The "Branching" Blind Spot:**
The *Development Progress* report highlights a "Git-style branching system." The 5.3 plan treats "carry-forward" as a linear progression (Scene 1  Scene 2). It does not specify if tag persistence is **branch-local** or **global**.
* *The Risk:* If a user creates a "What-if" branch where a character gets "Bloody" in Scene 3, and then switches back to the `main` branch, do those tags persist? The plan needs to define the "Scope of Persistence."


* **Linearity Assumption vs. Production Reality:**
The plan assumes users work on scenes in chronological order ( logic). In film production, users often jump around.
* *The Risk:* If I define tags for Scene 10, then go back and change Scene 5, the "Carry-Forward" logic might need to trigger a "downstream invalidation." The current plan doesn't account for backward-editing affecting future scenes already established.


* **"Prompt Fatigue" Risk:**
Task 4 focuses on "Tag Propagation Prompts." If every tag change triggers a modal/prompt for every subsequent scene, the UX will become intrusive.
* *Correction:* There should be a "Propagate to all subsequent scenes" checkbox to allow for bulk updates without 20 clicks.



### 2. What Is Solid and Well-Designed?

* **Categorized Styling (Task 5):**
Using category-based colors (e.g., `text-amber-400` for conditions vs. `text-blue-400` for locations) is excellent. It prevents the "tag soup" problem common in complex metadata systems and aligns with the existing Stage 8 UI logic.
* **Leveraging Existing Schema:**
The plan correctly identifies that the heavy lifting (migration 015) is already done. By focusing on UI and persistence logic rather than database restructuring, it stays within the **11–16 hour** effort estimate.
* **Search & Filter Integration:**
Integrating tags into the `SceneAssetListPanel` filter is vital. As projects grow to dozens of assets per scene, "Find all 'muddy' characters" becomes a primary user workflow for continuity checking.

### 3. Medium / Low-Level Design Gaps

* **The Stage 8 vs. Stage 10 Boundary:**
According to the PRD, *Stage 8* owns "Visual State" and *Stage 10* owns "Visual Evolution."
* *The Gap:* If a tag is "Bloody" in Stage 8, does that tag automatically get injected into the Stage 10 video prompt? The plan should specify that these tags are the **source of truth** for the prompts generated in later stages.


* **Data Integrity (Copy vs. Reference):**
When a tag is "carried forward" from Scene 1 to Scene 2, is it a **new record** in the `status_tags` array for Scene 2, or a pointer?
* *Recommendation:* It should be a **hard copy**. If a character cleans themselves in Scene 3, removing the "Muddy" tag there should not retroactively remove it from Scene 1. The plan implies this but doesn't explicitly state the "decoupling" logic.


* **Normalization vs. Creativity:**
The plan mentions "Normalizing to lowercase."
* *The Gap:* While good for search, you may want a **"Suggested Tags"** list based on previous scenes to prevent a user from tagging one asset as `muddy` and another as `dirt-covered`, which would break the filtering system.



### Suggested "Critical" Addition to the Plan:

Before Task 1, I recommend adding a **"Task 0: Branch-Awareness Logic."** This task should define that `status_tags` updates only propagate within the current `branch_id`. This protects the "Git-style" integrity described in your progress report.

### Final Assessment:

The plan is **85% ready**. If you address the **branching isolation** and the **downstream propagation** (bulk updates), it is a safe and highly effective roadmap for Feature 5.3.