We Recetly implemented the follwing: @3.4-implementation-summary.md  and now Im testing . Now for the testing guide I want to focus on the following test:  ### Test 6: Image Localization

**Steps:**
1. Create a global asset with an image
2. Clone it into a project
3. Check Supabase Storage:
   - Original image should be in global location
   - Cloned image should be in `project_{projectId}/branch_{branchId}/master-assets/`
4. Delete the global asset (or its image)
5. Verify project asset's image still works

**Expected Result:** Project asset has its own copy of the image, independent of global asset.  ......... See I actually can't create a global asset's image; like there is no ability to generate an image off a description NOR upload a image of said asset. However, in a broader sense of this Stage 5 feature & global asset funcitonality (@project-overview.md (481-495) ;  @project-overview.md (172-185) ) WHATS MOST IMPORTANT IS MAKEING THIS AS USEFUL TO A CREATIVE. WHAT I WANT IS TO BE ABLE TO TAKE AN ASSET FROM GLOBAL (BRINGING IN A PHOTO + GENERATING IT IN THE GLOBAL PANEL), THEN BRING IT INTO A PROJECT IN STAGE 5 (PERHAPS MASHING DESCRIPTIONALLY WITH THE LOCAL DESRIPTION - BY THAT I MEAN THE EXTRACTION WILL BRING OUT A DESCRIPTION FROM THE WRITTEN MATERIAL (STAGES 1-4) 

SO FOR EXAMPLE, BOB (IN THE GLOBAL ASSET) IS A BUILDER MAN (WITH A PICTURE EXAMPLE OR DESCRIPTION (ONE IS MANDATORY, OTHER IS OPTIONAL, MUST HAVE AT LEAST ONE; IMAGE UPLOAD/GENERATED RECOMMENDED ))), BUT FOR THE PROJECT, BOB IS IN SPACE, SO FOR THE STAGE 5, YOU'D WANT TO BRING IN THE BOB GLOBAL ASSETS IMAGE (IN A CONSTRUCTION BUILDER OUTFIT), AND BE ABLE TO THEN EDIT IT WITH THE PROJECT'S DESCRIPTION IN STAGE SO THAT THE GENERATION HAS BOB, BUT IN A SPACE SUIT. DOES THIS MAKE SENSE?  ... .Please ask me questions about this to really lock down how to fix this, i hope this makes sense; take a peak at the relevant files to get your bearings. ... In a way this issue also relates to the followign: """ (*Test 4: Non-Destructive Sync**

**Steps:**
1. Clone a global asset into a project
2. Edit the asset's description in the project (creates override)
3. Update the global asset's description (different from project version)
4. Update the global asset's `image_prompt` (or any other field)
5. Click "Sync Available" badge
6. Click "Update" on the outdated asset
7. Verify:
   - Asset's `description` remains unchanged (your edit preserved)
   - Asset's `image_prompt` is updated (not overridden)
   - `source_version` is updated to match global
   - `last_synced_at` is set to current timestamp
   - Success toast appears

**Expected Result:** Overridden fields are preserved, non-overridden fields are synced.)  """ I say it realtes because in a way we are trying to find the perfect usecase for bringing in global assets to new projects being designed. I think what is ideal is to be able to take major aspects of a global asset,  (if not the asset in it's entireity unedited)  and use it in stage 5, being able to sync it with character that may have been extracted from the text. Let me walk through another example: say the text called a prop a hammer, but the global asset you wanted to use was "the golden hammer" you should be able to bring in that golden hammer global aseet, and sync /swap it into the spot/role of the "hammer' but say the hammer in the story is coverred in dirt, well that "covered in dirt" description could be noted in with this asset still (remaining from the extraction) and thus, a new generation could be made, where "the golden hammer" asset (image already existing from the global asset sync) is regenerate, to be the golden hammer, but with dirt all over it. I hope this is clear, let's walk through how to incorporate this improved functionality for Stage 5 feature


*Cursor*: 

Reviewing the current implementation to understand the structure before proposing improvements.

## Questions

1. **Asset matching in Stage 5:**
   - a) Automatic by name similarity (e.g., "hammer" matches "golden hammer")
   - b) Manual selection via UI (user picks which global asset matches each extracted asset)
   - c) Both: suggest matches, allow manual override

2. **Description merging strategy:**
   - a) Global description as base, project description as additions/modifications (e.g., "Bob the builder" + "in space" ‚Üí "Bob the builder, now in space")
   - b) Project description as base, global description as context (e.g., "Bob in space" + "builder" ‚Üí "Bob in space, a builder")
   - c) LLM-merged synthesis of both descriptions

3. **Image regeneration approach:**  (*these maybe worth exploring all*)
   - a) Use merged description only (no reference to global image)
   - b) Use global image as reference/seed with merged description as modifications
   - c) Show both images side-by-side and let user choose which to use as base

4. **Global asset image requirement:**
   - a) Image OR description required (at least one)
   - b) Image recommended but not required if description exists
   - c) Image always required for cloning into projects

5. **UI workflow for merging:** (*these maybe worth exploring all*)
   - a) Show extracted assets first, then allow "Replace with Global Asset" action
   - b) Show both extracted and global assets, allow drag-and-drop matching
   - c) Show extracted assets with "Match Global Asset" button that opens a search/select dialog

Share your preferences and I‚Äôll draft the implementation plan.

Question Anwsers: 1: C), Honestly I think just opening the asset drawer, and then choosing the global asset to bring in, and get like a little modal to "match with a extracted asset, and like you can just do a drag and drop to pick the asset it's matching, so I guess it's manuel;  2: A seems great! (Global description as base, project description as additions/modifications (e.g., "Bob the builder" + "in space" ‚Üí "Bob the builder, now in space")) 3: b) Use global image as reference/seed with merged description as modifications ... however, regenerating the image should not be mandatory, and if the user likes the global asset as is, they can choose to keep it exactly as is (thus the description can be choosen to be completely overwritten (global asset completley replaces the extracted asset 4) Global asset image requirement:
a) Image OR description required (at least one)   5) Do whatever you think is best, but keep in mind, we may want to also to bring in a global asset without replacing an extracted asset (I believe the functionality is already in place. 

(Other thoughs: A: and then for the description, the user can choose whether to keep the description of the project or the global asset or merge them wisely? ; 



---
okay please write me a quick summary of what you implemented, with short whys, and a step-by-step testing checklist markdown file


---
### *Testing, Debugging Prompts*

We recently implemented the following:   @3.EXTRA-global-asset-image-implementation-summary.md and now we are in the process of testing said implementation, following this checklist: @3.EXTRA-testing-checklist.md . As of now, it perfectly passes  tests 1-3, but for test 4: ( @3.EXTRA-testing-checklist.md (99-112) ), After pressing generate image in the modal for editing a global asset, it Loads for a while, then seems to stop, but the image doesn't populate the space allocated for it in the modal. (I believe a toast appears once it stopped "loading", but i didn't catch what is said) However when I clicked the button "Update asset" and the modal closed, the card for the asset then had the generated image present visually in the card. So, basically, we need to make sure the asset image, once generated, appears in the modal in the space allocated for it. Additionally, there is no button for "generating image" for an asset when creating a new one, I think it would be best  if a user could have that option, but basically they have to fill out a description of at least 20 characters to be able to press the generate image button; like it should be upressable/locked until the decripton / image prompt is filled out so as to make sure there is enough context for the program to be able to generate the asset well.  Here are some logs from my testing


### Backend logs:
[Assets API] Image generation requested for global asset e7bf8e5a-8bf8-4917-a818-c73f83477251
[ImageService] Generating image for global asset e7bf8e5a-8bf8-4917-a818-c73f83477251 (character): 512x768
[ImageService] Created global asset job c9e2a098-ace2-45e5-841f-adee5b3438ff, queued for execution
[NanoBanana] Generating image (attempt 1)...
[ImageService] Updated global_assets.image_key_url for asset e7bf8e5a-8bf8-4917-a818-c73f83477251
[ImageService] Global asset job c9e2a098-ace2-45e5-841f-adee5b3438ff completed successfully

### frontend logs: (These two errors appeared repetitively)
Failed to load resource: the server responded with a status of 404 (Not Found)
AssetDialog.tsx:181 Error checking job status: Error: Job not found
    at AssetService.checkImageJobStatus (assetService.ts:236:13)
    at async AssetDialog.tsx:159:29
api/images/jobs/c9e2‚Ä¶841f-adee5b3438ff:1   
## AND THEN AFTER Pressing update asset these logs were in the frontend console:


AssetDialog.tsx:236 [AssetDialog] Updating asset: e7bf8e5a-8bf8-4917-a818-c73f83477251
AssetDialog.tsx:243 [AssetDialog] Asset updated: 
Object
asset_type
: 
"character"
created_at
: 
"2026-01-22T15:25:14.814056+00:00"
description
: 
"A mash up of James Bond but in Spongebob form; or in other words, a porous, bright yellow, square-shaped anthropomorphic sea sponge resembling a kitchen sponge, with angular blue eyes, a chiseled jaw, handsome, combed back black hair, and  typically wearing a black tie suit, and black shoes, known for his flexibility, seductive spy swagger, and ability to absorb water."
id
: 
"e7bf8e5a-8bf8-4917-a818-c73f83477251"
image_key_url
: 
"https://gdnurgghtmauclfkkvif.supabase.co/storage/v1/object/public/asset-images/global/fa58ace1-ae7e-4dd8-ab54-1fbe453701f2/e7bf8e5a-8bf8-4917-a818-c73f83477251/1769096418633_yibvyb7.png"
image_prompt
: 
null
name
: 
"SpongeBond"
promoted_from_project_id
: 
null
updated_at
: 
"2026-01-22T15:43:27.591087+00:00"
user_id
: 
"fa58ace1-ae7e-4dd8-ab54-1fbe453701f2"
version
: 
3
visual_style_capsule_id
: 
null
voice_profile_id
: 
null
[[Prototype]]
: 
Object
AssetLibrary.tsx:96 [AssetLibrary] Asset saved, reloading...
AssetLibrary.tsx:39 [AssetLibrary] Loading assets...
AssetLibrary.tsx:41 [AssetLibrary] Loaded assets: 
Array(4)  ..................................
------------------------------------------------------------------------------------
 Test #: Result
 1: pass
 2: pass (may need to make up modal scrollable)
 3: pass
 4: Now the only thing is that two versions of the global asset are being generated when  
 

 
 Test 4: 
 Loads for a while, then seems to stop, but the image doesn't populate the space allocated for it in the modal. (I believe a toast appears once it stopped "loading", but i didn't catch what is said) However when I clicked the button "Update asset" and the modal closed, the card for the asset then had the generated image present vis


Test 5:
You need to add visual style capsule to global asset generation application 

We also need to allow for global asset (deplication) in the unstance wants to make a new version of the asset but with minor changes, and doesnt want to lose the original asset
---

---
*Hmm I'm not sure how much the image examples for the visual style capsule are influencing the artistic generation of the visual assets (stage 5 & global assets)*
---
npx tsx backend/scripts/test-style-capsule-influence.ts f69802b7-6627-491b-ba77-cf707e154ea2 "A futuristic robot character"
üß™ Visual Style Capsule Influence Test
=====================================

Capsule ID: f69802b7-6627-491b-ba77-cf707e154ea2
Test Prompt: A futuristic robot character

üìä Capsule Analysis:
  Name: Los Heuvitos style
  Has Descriptor Strings: true (795 chars)
  Has Design Pillars: true (5 items)
  Has Reference Images: true (4 images)

üîÑ Test 1: Generating with reference images (NEW implementation)...
‚ùå No authenticated user found. Please ensure you are logged in.
   You may need to set SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY in your .env file   ... I got this error; Now those .env files are located in my project root and my backend folder; why can't it locate it (these files are cursorignore so you wont be able to see them but they are there)
