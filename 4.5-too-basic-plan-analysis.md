The implementation plan for **Feature 4.5 (Shot List Validation & Locking)** is logically sound and aligns with the projectâ€™s "Gatekeeper" pattern seen in Stage 5 [cite: 3.3 - STAGE-5-IMPLEMENTATION-SUMMARY.md]. However, because this feature bridges the gap between **Phase A (Narrative)** and **Phase B (Production)**, the locking mechanism carries heavy architectural weight regarding data integrity and cost.

### **Key Flaws and Risks**

1. **Status Tag Desync (Medium Risk)**
* **The Flaw**: The plan focuses on validating shot fields but doesn't mention updating the `scene_status` in the `scenes` table [cite: 4.5-plan-v0.md].
* **The Risk**: If the UI shows "Locked" but the scene status remains `pending`, downstream stages (8 and 9) might not unlock correctly, or the Stage 6 Script Hub will show incorrect progress indicators [cite: 4.1-IMPLEMENTATION-SUMMARY.md].


2. **The "Ghost Character" Problem**
* **The Flaw**: Stage 5 (Global Assets) creates the pool of characters. Feature 4.5 checks if character fields are filled but doesn't inherently verify if the character entered in a shot actually exists in the Project Assets [cite: 3.3 - STAGE-5-IMPLEMENTATION-SUMMARY.md].
* **The Risk**: If a user typos a character name in a shot, Stage 8 (Asset Assignment) will fail to find a matching asset, breaking the "Asset Assembly" pipeline [cite: project-overview.md].


3. **Concurrency during Locking**
* **The Risk**: Since Stage 7 uses debounced auto-save (500ms) [cite: 4.3-plan-v0.md], a user might click "Lock" while a final field edit is still in the debounce queue. The "Lock" command might arrive at the server before the last update, resulting in an "Incomplete" error or, worse, locking a stale version of the shot.



---

### **Recommendations & Answers to Open Questions**

#### **1. Warnings vs. Errors (Duration)**

* **Recommendation**: **Warning (Bypassable).**
* **Reasoning**: In filmmaking, "unusual" durations are often creative choices (e.g., a 0.5s flicker cut or a 30s slow-motion tracking shot). Hard errors on duration would frustrate power users.
* **Implementation**: Show a yellow icon: *"Short Duration (2s). Is this intentional?"*

#### **2. Unlock Restrictions (Downstream Impact)**

* **Recommendation**: **Allow with "Destructive Warning" if Stage 10+ is started.**
* **Reasoning**: Per the **Deterministic Invalidation** principle [cite: database-schema-state-transition-matrix.md], changing a shot list after frames are generated invalidates those frames.
* **UX Policy**: "Unlocking this scene will archive existing frames and videos for this scene. Do you wish to proceed?"

#### **3. Shot Coherence (Advanced Checks)**

* **Character Validation**: **Highly Recommended.** Validate that `shot.characters` is a subset of the characters extracted in Stage 5. This prevents "Orphaned Shots" in Stage 8.
* **Continuity**: Check for **Dialogue Gaps**. If the Scene Script has dialogue for "John," but none of the shots in the shot list contain that dialogue, flag a warning: *"Dialogue for 'John' is missing from the technical breakdown."*

#### **4. Validation Scope (Real-time vs. Gate)**

* **Recommendation**: **Hybrid approach.**
* **Real-time**: Show subtle visual indicators (red bottom-border or dot) on empty required fields during editing. This reduces "Validation Shock" at the end.
* **Gate**: Perform a full, strict server-side check only when the "Lock" button is pressed.

#### **5. Force Lock**

* **Recommendation**: **Bypass Warnings only.** * **Policy**:
* **Errors** (e.g., empty Shot Description, 0 shots in list) = **Un-bypassable.** * **Warnings** (e.g., short duration, missing optional prop) = **Bypassable.**


* **Audit Trail**: If a user uses "Force Lock," log a `metadata` flag on the `scene_status` indicating it was a forced approval.

### **Solid & Well-Designed Aspects**

* **PostgreSQL Migration**: Adding `shot_list_locked_at` directly to the `scenes` table is the correct move for performance; it avoids expensive joins with the `stage_states` table just to check status [cite: 4.5-plan-v0.md].
* **Template Adherence**: Following the Stage 5 pattern ensures UI consistency, which is vital for a complex 12-stage app [cite: architecture-and-rules.md].
* **Backend Validation Service**: Moving logic to `shotValidationService.ts` keeps the `projects.ts` route clean and testable [cite: 4.5-plan-v0.md].

### **Final Verdict**

The plan is **Sound**, provided you address the **Auto-save race condition** by ensuring the "Lock" action forces a final sync of any pending debounced changes before executing the validation.


# Second, Second Opinion:

# Feature 4.5: Shot List Validation & Locking - Comprehensive Analysis

**Document Version:** 1.0  
**Date:** January 30, 2026  
**Feature:** Phase 4.5 - Shot List Validation & Locking  
**Plan Under Review:** `4.5-plan-v0.md`  
**Status:** Architecture Review Complete

---
