## Step-by-Step Testing Guide

### **IMPORTANT TO DEAL WITH: Non-Destructive Sync**

**Steps:**
1. Clone a global asset into a project
2. Edit the asset's description in the project (creates override)
3. Update the global asset's description (different from project version)
4. Update the global asset's `image_prompt` (or any other field)
5. Click "Sync Available" badge
6. Click "Update" on the outdated asset
7. Verify:
   - Asset's `description` remains unchanged (your edit preserved)
   - Asset's `image_prompt` is updated (not overridden)
   - `source_version` is updated to match global
   - `last_synced_at` is set to current timestamp
   - Success toast appears

**Expected Result:** Overridden fields are preserved, non-overridden fields are synced.


**Hmm okay I see what was going on, SO I was have been deviating from what the plan demanded by ignorance. See the plan (as told by testing checklist)* 

WE NEED TO DEAL WITH THIS SYNCING SHIT, BUT WHATS MOST IMPORTANT IS MAKEING THIS MOST USEFUL. WHAT I WANT IS TO BE ABLE TO TAKE AN ASSET FROM GLOBAL (BRINGING IN A PHOTO + GENERATING IT IN THE GLOBAL PANEL), THEN BRING IT INTO A PROJECT IN STAGE 5 (PERHAPS MASHING DESCRIPTIONALLY WITH THE LOCAL DESRIPTION - BY THAT I MEAN THE EXTRACTION WILL BRING OUT A DESCRIPTION FROM THE WRITTEN MATERIAL (STAGES 1-4) 

SO FOR EXAMPLE, BOB (IN THE GLOBAL ASSET) IS A BUILDER MAN (WITH A PICTURE EXAMPLE OR DESCRIPTION (ONE IS MANDATORY, OTHER IS OPTIONAL, MUST HAVE AT LEAST ONE; IMAGE UPLOAD/GENERATED RECOMMENDED ))), BUT FOR THE PROJECT, BOB IS IN SPACE, SO FOR THE STAGE 5, YOU'D WANT TO BRING IN THE BOB GLOBAL ASSETS IMAGE (IN A CONSTRUCTION BUILDER OUTFIT), AND BE ABLE TO THEN EDIT IT WITH THE PROJECT'S DESCRIPTION IN STAGE SO THAT THE GENERATION HAS BOB, BUT IN A SPACE SUIT. DOES THIS MAKE SENSE? 

----------------------
My rambling prompt: 
We Recetly implemented the follwing: @3.4-implementation-summary.md  and now Im testing . Now for the testing guide I want to focus on the following test:  ### Test 6: Image Localization

**Steps:**
1. Create a global asset with an image
2. Clone it into a project
3. Check Supabase Storage:
   - Original image should be in global location
   - Cloned image should be in `project_{projectId}/branch_{branchId}/master-assets/`
4. Delete the global asset (or its image)
5. Verify project asset's image still works

**Expected Result:** Project asset has its own copy of the image, independent of global asset.  ......... See I actually can't create a global asset's image; like there is no ability to generate an image off a description NOR upload a image of said asset. However, in a broader sense of this Stage 5 feature & global asset funcitonality (@project-overview.md (481-495) ;  @project-overview.md (172-185) ) WHATS MOST IMPORTANT IS MAKEING THIS AS USEFUL TO A CREATIVE. WHAT I WANT IS TO BE ABLE TO TAKE AN ASSET FROM GLOBAL (BRINGING IN A PHOTO + GENERATING IT IN THE GLOBAL PANEL), THEN BRING IT INTO A PROJECT IN STAGE 5 (PERHAPS MASHING DESCRIPTIONALLY WITH THE LOCAL DESRIPTION - BY THAT I MEAN THE EXTRACTION WILL BRING OUT A DESCRIPTION FROM THE WRITTEN MATERIAL (STAGES 1-4) 

SO FOR EXAMPLE, BOB (IN THE GLOBAL ASSET) IS A BUILDER MAN (WITH A PICTURE EXAMPLE OR DESCRIPTION (ONE IS MANDATORY, OTHER IS OPTIONAL, MUST HAVE AT LEAST ONE; IMAGE UPLOAD/GENERATED RECOMMENDED ))), BUT FOR THE PROJECT, BOB IS IN SPACE, SO FOR THE STAGE 5, YOU'D WANT TO BRING IN THE BOB GLOBAL ASSETS IMAGE (IN A CONSTRUCTION BUILDER OUTFIT), AND BE ABLE TO THEN EDIT IT WITH THE PROJECT'S DESCRIPTION IN STAGE SO THAT THE GENERATION HAS BOB, BUT IN A SPACE SUIT. DOES THIS MAKE SENSE?  ... .Please ask me questions about this to really lock down how to fix this, i hope this makes sense; take a peak at the relevant files to get your bearings. ... In a way this issue also relates to the followign: """ (*Test 4: Non-Destructive Sync**

**Steps:**
1. Clone a global asset into a project
2. Edit the asset's description in the project (creates override)
3. Update the global asset's description (different from project version)
4. Update the global asset's `image_prompt` (or any other field)
5. Click "Sync Available" badge
6. Click "Update" on the outdated asset
7. Verify:
   - Asset's `description` remains unchanged (your edit preserved)
   - Asset's `image_prompt` is updated (not overridden)
   - `source_version` is updated to match global
   - `last_synced_at` is set to current timestamp
   - Success toast appears

**Expected Result:** Overridden fields are preserved, non-overridden fields are synced.)  """ I say it realtes because in a way we are trying to find the perfect usecase for bringing in global assets to new projects being designed. I think what is ideal is to be able to take major aspects of a global asset,  (if not the asset in it's entireity unedited)  and use it in stage 5, being able to sync it with character that may have been extracted from the text. Let me walk through another example: say the text called a prop a hammer, but the global asset you wanted to use was "the golden hammer" you should be able to bring in that golden hammer global aseet, and sync /swap it into the spot/role of the "hammer' but say the hammer in the story is coverred in dirt, well that "covered in dirt" description could be noted in with this asset still (remaining from the extraction) and thus, a new generation could be made, where "the golden hammer" asset (image already existing from the global asset sync) is regenerate, to be the golden hammer, but with dirt all over it. I hope this is clear, let's walk through how to incorporate this improved functionality for Stage 5 feature


### Test 1: Clone Global Asset into Project

**Steps:**
1. Navigate to Stage 5 of a project
2. Ensure you have at least one global asset in your library (create one if needed)
3. Click "Browse Global Library" button
4. Asset drawer should slide out from bottom
5. Search or filter assets as needed
6. Click "Clone to Project" on any asset
7. Verify:
   - Success toast notification appears
   - Asset appears in the project asset list
   - Asset has `global_asset_id` set (check in database if needed)
   - If asset had an image, it should be copied to project storage

**Expected Result:** Asset is cloned successfully and appears in Stage 5 asset list.

*USER RESULT*: Passes 

### Test 2: Override Tracking on Edit

**Steps:**
1. Clone a global asset into a project (from Test 1)
2. Edit the asset's description in Stage 5
3. Save the changes
4. Check database: `SELECT overridden_fields FROM project_assets WHERE id = '74401e29-a537-4623-99b0-f2ea2eedfb9d'`
5. Verify `overridden_fields` contains `['description']`

**Expected Result:** `overridden_fields` array contains the edited field name.

*USER RESULT*: Passes  (see )



### Test 3: Version Sync Detection

**Steps:**
1. Clone a global asset into a project
2. Note the asset's `source_version` (should match global asset's `version`)
3. Update the global asset (change description, increment version)
4. Return to Stage 5
5. Look for "Sync Available" badge with count indicator
6. Click the badge to open sync dialog
7. Verify:
   - Dialog shows the outdated asset
   - Shows version numbers (e.g., "v1 ‚Üí v3")
   - Shows asset name

**Expected Result:** Version sync UI detects outdated asset and displays it in the dialog.

*USER RESULT*:The Version number is present;  but I do not see the "Sync Available badge no where; perhaps this console log shows the issue more clearly: {{ projectAssetService.ts:445  GET http://localhost:8080/api/projects/18984948-7a45-4188-b1d8-5b96ddde58cf/assets/version-sync-status 404 (Not Found)
checkVersionSync @ projectAssetService.ts:445
await in checkVersionSync
checkVersionSync @ AssetVersionSync.tsx:52
(anonymous) @ AssetVersionSync.tsx:43
setInterval
(anonymous) @ AssetVersionSync.tsx:42 }}

### **Test 4: Non-Destructive Sync**

**Steps:**
1. Clone a global asset into a project
2. Edit the asset's description in the project (creates override)
3. Update the global asset's description (different from project version)
4. Update the global asset's `image_prompt` (or any other field)
5. Click "Sync Available" badge
6. Click "Update" on the outdated asset
7. Verify:
   - Asset's `description` remains unchanged (your edit preserved)
   - Asset's `image_prompt` is updated (not overridden)
   - `source_version` is updated to match global
   - `last_synced_at` is set to current timestamp
   - Success toast appears

**Expected Result:** Overridden fields are preserved, non-overridden fields are synced.


**Hmm okay I see what was going on, SO I was have been deviating from what the plan demanded by ignorance. See the plan (as told by testing checklist)* 

### Test 5: Sync All Assets

**Steps:**
1. Clone multiple global assets into a project
2. Update some of the global assets (increment versions)
3. Click "Sync Available" badge
4. Click "Update All" button
5. Verify:
   - All outdated assets are synced
   - Success toast shows count of updated assets
   - Dialog closes after completion

**Expected Result:** All outdated assets are synced in one operation.

### Test 6: Image Localization

**Steps:**
1. Create a global asset with an image
2. Clone it into a project
3. Check Supabase Storage:
   - Original image should be in global location
   - Cloned image should be in `project_{projectId}/branch_{branchId}/master-assets/`
4. Delete the global asset (or its image)
5. Verify project asset's image still works

**Expected Result:** Project asset has its own copy of the image, independent of global asset.

### Test 7: Promotion with Confirmation

**Steps:**
1. In Stage 5, ensure an asset has a generated image
2. Click the asset's dropdown menu (three dots)
3. Click "Promote to Global Library"
4. Verify:
   - Confirmation dialog appears
   - Dialog shows asset name
   - Click "Promote" to confirm
   - Success toast appears
   - Asset is now in global library

**Expected Result:** Promotion requires confirmation and creates global asset.

### Test 8: Clone with Override Description

**Steps:**
1. Open Asset Drawer
2. Select a global asset
3. Before cloning, note the global asset's description
4. Clone the asset (you'll need to modify the service call or add UI for this)
5. Provide a custom `overrideDescription`
6. Verify:
   - Cloned asset has custom description
   - `overridden_fields` contains `['description']`

**Expected Result:** Clone with override description tracks the override automatically.

### Test 9: Error Handling

**Test Cases:**
1. Try to clone non-existent global asset ‚Üí Should show error
2. Try to sync locked asset ‚Üí Should show error
3. Try to sync asset without `global_asset_id` ‚Üí Should show error
4. Try to clone with invalid branch ‚Üí Should show error

**Expected Result:** All error cases show appropriate error messages.

### Test 10: UI/UX Polish

**Verify:**
1. Asset drawer animations are smooth
2. Loading states appear during operations
3. Empty states show when no assets found
4. Search and filters work correctly
5. Grid/List view toggle works
6. Version sync badge updates automatically
7. All toast notifications are clear and helpful

**Expected Result:** UI is polished and provides good user feedback.



















We need to tweak!


### *Preface*: Assets can still be extracted & images can be genereated; AND like previously, visual style gets locked on selection

*Logs of this basic functionality check to make sure things still work*:
Backend Logs:

‚úÖ Stage state inserted successfully: 04833f38-5377-468e-bb29-556f6f7af03e
[ProjectAssets] ========== EXTRACT ENDPOINT HIT ==========
[ProjectAssets] Project ID: 18984948-7a45-4188-b1d8-5b96ddde58cf
[ProjectAssets] User ID: fa58ace1-ae7e-4dd8-ab54-1fbe453701f2
[ProjectAssets] Looking for latest Stage 5 state for branch: 8429f61d-dc31-44ef-ae95-faf999840537
[ProjectAssets] Stage 5 states query result: { stage5States: [ { content: [Object] } ], stage5Error: null }
[ProjectAssets] Visual style ID found: f69802b7-6627-491b-ba77-cf707e154ea2
[ProjectAssets] Looking for latest Stage 4 state for branch: 8429f61d-dc31-44ef-ae95-faf999840537
[ProjectAssets] Stage 4 states query result: { stage4States: [ { content: [Object] } ], stage4Error: null }
[ProjectAssets] Master script found: true EXT. DUCKERAIINE COUNTRYSIDE - MORNING

A vast, impossibly green meadow stretches under a cerulean s...
[ProjectAssets] Starting extraction for project 18984948-7a45-4188-b1d8-5b96ddde58cf
[AssetExtraction] Starting two-pass extraction...
[LLM] Starting generation request 0a23c89e-d7b7-4048-bfe5-852b3a07b74d with model gemini-2.5-flash-lite
[LLM] LangSmith tracing not available, continuing without tracing: Error: Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.
    
[LLM] Generation completed in 24257ms, 4859 tokens, $0.0008
[LLM] Successfully completed request 0a23c89e-d7b7-4048-bfe5-852b3a07b74d
[AssetExtraction] Pass 1 complete: 15 entities found
[AssetExtraction] Failed to fetch style context, using default
[LLM] Starting generation request 439bbf0b-fb1b-46ea-b1cc-f8542ccb6d5e with model gemini-2.5-flash-lite
[LLM] LangSmith tracing not available, continuing without tracing: Error: Could not get the current run tree.


## Relevant Console Log Frontend:

useStageState.ts:122 üîÑ Auto-save triggered for stage 5 with content keys: Array(2)
stageStateService.ts:197 ‚è≥ Auto-save scheduled in 1000ms
stageStateService.ts:97 ‚úÖ Auth session found, making API request...
stageStateService.ts:113 üì§ Request body: Object
stageStateService.ts:124 üì• Response status: 200
stageStateService.ts:133 ‚úÖ Save successful: Object
stageStateService.ts:187 ‚úÖ Auto-save completed successfully
useStageState.ts:128 üìã Auto-save callback: Object
useStageState.ts:140 üßπ Cleaning up auto-save for: 18984948-7a45-4188-b1d8-5b96ddde58cf 5
useStageState.ts:122 üîÑ Auto-save triggered for stage 5 with content keys: Array(2)
stageStateService.ts:197 ‚è≥ Auto-save scheduled in 1000ms
stageStateService.ts:97 ‚úÖ Auth session found, making API request...
stageStateService.ts:113 üì§ Request body: Object
stageStateService.ts:124 üì• Response status: 200
stageStateService.ts:133 ‚úÖ Save successful: Object
stageStateService.ts:187 ‚úÖ Auto-save completed successfully
useStageState.ts:128 üìã Auto-save callback: Object
projectAssetService.ts:54 [ProjectAssetService] Extracting assets for project 18984948-7a45-4188-b1d8-5b96ddde58cf
projectAssetService.ts:445  GET http://localhost:8080/api/projects/18984948-7a45-4188-b1d8-5b96ddde58cf/assets/version-sync-status 404 (Not Found)
checkVersionSync @ projectAssetService.ts:445
await in checkVersionSync
checkVersionSync @ AssetVersionSync.tsx:52
(anonymous) @ AssetVersionSync.tsx:39

projectAssetService.ts:445  GET http://localhost:8080/api/projects/18984948-7a45-4188-b1d8-5b96ddde58cf/assets/version-sync-status 404 (Not Found)
checkVersionSync @ projectAssetService.ts:445


{{REDUNDANT CONTENT REMOVED FOR BREVITY}}


performWorkUntilDeadline @ chunk-R6S4VRB5.js?v=f5e477af:384
projectAssetService.ts:445  GET http://localhost:8080/api/projects/18984948-7a45-4188-b1d8-5b96ddde58cf/assets/version-sync-status 404 (Not Found)
checkVersionSync @ projectAssetService.ts:445
await in checkVersionSync
AssetVersionSync.tsx:58 Failed to check version sync: Error: Asset not found
    at ProjectAssetService.checkVersionSync (projectAssetService.ts:455:13)
    at async checkVersionSync (AssetVersionSync.tsx:52:22)

projectAssetService.ts:248 [ProjectAssetService] Generating image for asset 646e3362-c46f-433f-a15a-251d5a9b94b2
projectAssetService.ts:306 ‚è≥ [ProjectAssetService] Job f9d82aab-2cd9-48b7-93c8-8b90c6d8ef73 status: processing
projectAssetService.ts:306 ‚è≥ [ProjectAssetService] Job f9d82aab-2cd9-48b7-93c8-8b90c6d8ef73 status: generating
projectAssetService.ts:306 ‚è≥ [ProjectAssetService] Job f9d82aab-2cd9-48b7-93c8-8b90c6d8ef73 status: uploading
projectAssetService.ts:293 ‚úÖ [ProjectAssetService] Image generation completed
projectAssetService.ts:445  GET http://localhost:8080/api/projects/18984948-7a45-4188-b1d8-5b96ddde58cf/assets/version-sync-status 404 (Not Found)
checkVersionSync @ projectAssetService.ts:445
await in checkVersionSync
AssetVersionSync.tsx:58 Failed to check version sync: Error: Asset not found

[LLM] Generation completed in 1269ms, 427 tokens, $0.0001
[LLM] Successfully completed request 7a18d183-d8b6-480f-a3df-f27f30d442f3
[AssetExtraction] Pass 2 complete: 15 assets distilled
    at async AssetExtractionService.extractAssets (C:\Users\Daniel Lopez\Desktop\Aiuteur\wizardirector\backend\src\services\assetExtractionService.ts:61:21)
[LLM] Generation completed in 1269ms, 427 tokens, $0.0001
[LLM] Successfully completed request 7a18d183-d8b6-480f-a3df-f27f30d442f3
[AssetExtraction] Pass 2 complete: 15 assets distilled
[AssetExtraction] Pass 2 complete: 15 assets distilled
[ProjectAssets] Extracted and saved 15 assets
[ProjectAssets] Generating image for asset 646e3362-c46f-433f-a15a-251d5a9b94b2 (character)
[ImageService] Auto-sizing character: 512x768
[ImageService] Created job f9d82aab-2cd9-48b7-93c8-8b90c6d8ef73, queued for execution
[NanoBanana] Generating image (attempt 1)...
[ImageService] Updated project_assets.image_key_url for asset 646e3362-c46f-433f-a15a-251d5a9b94b2
[ImageService] Job f9d82aab-2cd9-48b7-93c8-8b90c6d8ef73 completed successfully
[ProjectAssets] Generating image for asset 646e3362-c46f-433f-a15a-251d5a9b94b2 (character)
[ImageService] Auto-sizing character: 512x768
[ImageService] Created job f9d82aab-2cd9-48b7-93c8-8b90c6d8ef73, queued for execution
[NanoBanana] Generating image (attempt 1)...
[ImageService] Updated project_assets.image_key_url for asset 646e3362-c46f-433f-a15a-251d5a9b94b2
[ImageService] Job f9d82aab-2cd9-48b7-93c8-8b90c6d8ef73 completed successfully
[ImageService] Updated project_assets.image_key_url for asset 646e3362-c46f-433f-a15a-251d5a9b94b2
[ImageService] Job f9d82aab-2cd9-48b7-93c8-8b90c6d8ef73 completed successfully




Future To-Dos:
## **Test 1**: Clone Global Asset into Project

Passes


Okay the global assets need to be able to accept and image input if they so like; for instance, image a user has a character they have already designed themselves and they want to use it in the story; they must be able to then use not just a written description but also the image as "the asset" though if they bring it into a project (in Stage 5) they should be made able to edit the image with a regeneration guiding prompt, so say they have a cowboy character, but for this story, he is in a soilder costume, as the plot involves said character in a war, they should be able to bring in teh cowboy from global to loca, then choose to edit it with the prompt to make him in solider costume. 




: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?

Check the render method of `PopChild`.